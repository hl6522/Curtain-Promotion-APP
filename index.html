<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>内部报价系统</title>
    <link rel="stylesheet" href="styles.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.29/jspdf.plugin.autotable.min.js"></script>
</head>
<body>
    <!-- 登录页面 -->
    <div id="loginPage" class="login-page">
        <div class="login-container">
            <h1>内部报价系统</h1>
            <div class="login-form">
                <div class="form-group">
                    <label>用户名:</label>
                    <input type="text" id="username" placeholder="请输入用户名">
                </div>
                <div class="form-group">
                    <label>密码:</label>
                    <input type="password" id="password" placeholder="请输入密码">
                </div>
                <button onclick="login()" class="btn-primary">登录</button>
                <button onclick="resetSystem()" class="btn-secondary" style="margin-top: 10px;">重置系统</button>
            </div>
        </div>
    </div>

    <!-- 销售员前台 -->
    <div id="salesFrontend" class="main-app" style="display: none;">
        <div class="container">
            <!-- 头部 -->
            <header>
                <div class="header-top">
                    <h1>销售员工作台</h1>
                    <div class="user-info">
                        <span id="currentUser"></span>
                        <button onclick="logout()" class="btn-logout">退出登录</button>
                    </div>
                </div>
                <div class="header-controls">
                    <button onclick="showTab('pricing')" class="tab-btn active">快速查价</button>
                    <button onclick="showTab('quotation')" class="tab-btn">新建报价</button>
                    <button onclick="showTab('myQuotations')" class="tab-btn">我的报价</button>
                    <button onclick="showTab('myCustomers')" class="tab-btn">我的客户</button>
                </div>
            </header>

            <!-- 快速查价 -->
            <div id="pricing" class="tab-content active">
                <div class="card">
                    <h2>快速查价</h2>
                    <div class="pricing-form">
                        <div class="pricing-header">
                            <h3>产品信息</h3>
                            <button onclick="addPricingRow()" class="btn-secondary">+ 添加行</button>
                        </div>
                        <div id="pricingRows">
                            <!-- 动态生成的行 -->
                        </div>
                        <div class="pricing-actions">
                            <button onclick="searchAllPrices()" class="btn-primary">查询价格</button>
                            <button onclick="addToQuotation()" class="btn-secondary" id="addToQuotationBtn" style="display: none;">确认 → 加入报价</button>
                        </div>
                    </div>
                    

                </div>
            </div>

            <!-- 新建报价 -->
            <div id="quotation" class="tab-content">
                <div class="card">
                    <h2>新建报价单</h2>
                    
                    <!-- 客户信息 -->
                    <div class="customer-info">
                        <h3>客户信息</h3>
                        <div class="form-row">
                            <div class="form-group">
                                <label>客户名称:</label>
                                <input type="text" id="customerName" placeholder="客户名称">
                            </div>
                            <div class="form-group">
                                <label>联系电话:</label>
                                <input type="text" id="customerPhone" placeholder="联系电话">
                            </div>
                        </div>
                        <div class="form-group">
                            <label>客户地址:</label>
                            <input type="text" id="customerAddress" placeholder="客户地址">
                        </div>
                        <div class="form-group">
                            <label>客户邮箱:</label>
                            <input type="email" id="customerEmail" placeholder="客户邮箱">
                        </div>
                    </div>

                    <!-- 产品明细 -->
                    <div class="product-items">
                        <h3>产品明细</h3>
                        <div id="productList"></div>
                        <button onclick="addProductItem()" class="btn-secondary">+ 添加产品</button>
                    </div>

                    <!-- 附加价格 -->
                    <div class="additional-prices">
                        <h3>附加价格</h3>
                        <div class="form-row">
                            <div class="form-group">
                                <label>附加价格1:</label>
                                <input type="text" id="additionalPrice1" placeholder="描述">
                                <input type="number" id="additionalAmount1" step="0.01" placeholder="金额">
                            </div>
                            <div class="form-group">
                                <label>附加价格2:</label>
                                <input type="text" id="additionalPrice2" placeholder="描述">
                                <input type="number" id="additionalAmount2" step="0.01" placeholder="金额">
                            </div>
                        </div>
                    </div>

                    <!-- 报价汇总 -->
                    <div class="quotation-summary">
                        <h3>报价汇总</h3>
                        <div class="summary-row">
                            <label>产品小计:</label>
                            <span id="subtotal">$0.00</span>
                        </div>
                        <div class="summary-row">
                            <label>附加价格:</label>
                            <span id="additionalTotal">$0.00</span>
                        </div>
                        <div class="summary-row">
                            <label>税率 (%):</label>
                            <input type="number" id="taxRate" value="0" min="0" max="100" step="0.1">
                        </div>
                        <div class="summary-row">
                            <label>税额:</label>
                            <span id="taxAmount">$0.00</span>
                        </div>
                        <div class="summary-row">
                            <label>运费:</label>
                            <input type="number" id="shippingFee" value="0" min="0" step="0.01">
                        </div>
                        <div class="summary-row total">
                            <label>总计:</label>
                            <span id="totalAmount">$0.00</span>
                        </div>
                    </div>

                    <div class="action-buttons">
                        <button onclick="saveQuotation()" class="btn-primary">保存报价单</button>
                        <button onclick="exportPDF()" class="btn-secondary">导出PDF</button>
                        <button onclick="exportExcel()" class="btn-secondary">导出Excel</button>
                        <button onclick="printQuotation()" class="btn-secondary">打印</button>
                    </div>
                </div>
            </div>

            <!-- 我的报价 -->
            <div id="myQuotations" class="tab-content">
                <div class="card">
                    <h2>我的报价单</h2>
                    <div id="quotationsList"></div>
                </div>
            </div>

            <!-- 我的客户 -->
            <div id="myCustomers" class="tab-content">
                <div class="card">
                    <h2>我的客户</h2>
                    <div id="customersList"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- 管理员后台 -->
    <div id="adminBackend" class="main-app" style="display: none;">
        <div class="container">
            <!-- 头部 -->
            <header>
                <div class="header-top">
                    <h1>管理员后台</h1>
                    <div class="user-info">
                        <span id="adminUser"></span>
                        <button onclick="logout()" class="btn-logout">退出登录</button>
                    </div>
                </div>
                <div class="header-controls">
                    <button onclick="showAdminTab('products')" class="tab-btn active">产品管理</button>
                    <button onclick="showAdminTab('pricing')" class="tab-btn">价目表管理</button>
                    <button onclick="showAdminTab('users')" class="tab-btn">用户管理</button>
                    <button onclick="showAdminTab('quotations')" class="tab-btn">报价管理</button>
                    <button onclick="showAdminTab('system')" class="tab-btn">系统设置</button>
                </div>
            </header>

            <!-- 产品管理 -->
            <div id="products" class="admin-tab-content active">
                <div class="card">
                    <h2>产品管理</h2>
                    <div class="product-form">
                        <div class="form-row">
                            <div class="form-group">
                                <label>品类:</label>
                                <input type="text" id="newCategory" placeholder="产品品类">
                            </div>
                            <div class="form-group">
                                <label>系统:</label>
                                <input type="text" id="newSystem" placeholder="产品系统">
                            </div>
                            <div class="form-group">
                                <label>产品编号1:</label>
                                <input type="text" id="newProductCode1" placeholder="字母+数字">
                            </div>
                            <div class="form-group">
                                <label>产品编号2:</label>
                                <input type="text" id="newProductCode2" placeholder="字母+数字">
                            </div>
                        </div>
                        <button onclick="addProduct()" class="btn-primary">添加产品</button>
                    </div>
                    <div id="productTableDisplay"></div>
                </div>
            </div>

            <!-- 价目表管理 -->
            <div id="pricing" class="admin-tab-content">
                <div class="card">
                    <h2>价目表管理</h2>
                    <div class="import-export">
                        <input type="file" id="priceFile" accept=".json,.csv" style="display: none;">
                        <button onclick="document.getElementById('priceFile').click()" class="btn-secondary">导入价目表</button>
                        <button onclick="exportPriceTable()" class="btn-secondary">导出价目表</button>
                        <button onclick="resetPriceTable()" class="btn-danger">重置价目表</button>
                    </div>
                    <div class="price-table-container">
                        <h4>当前价目表</h4>
                        <div id="priceTableDisplay"></div>
                    </div>
                </div>
            </div>

            <!-- 用户管理 -->
            <div id="users" class="admin-tab-content">
                <div class="card">
                    <h2>用户管理</h2>
                    <div class="user-form">
                        <div class="form-row">
                            <div class="form-group">
                                <label>用户名:</label>
                                <input type="text" id="newUsername" placeholder="用户名">
                            </div>
                            <div class="form-group">
                                <label>密码:</label>
                                <input type="password" id="newPassword" placeholder="密码">
                            </div>
                            <div class="form-group">
                                <label>角色:</label>
                                <select id="newUserRole">
                                    <option value="sales">销售员</option>
                                    <option value="admin">管理员</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>姓名:</label>
                                <input type="text" id="newUserRealName" placeholder="真实姓名">
                            </div>
                            <div class="form-group">
                                <label>电话:</label>
                                <input type="text" id="newUserPhone" placeholder="联系电话">
                            </div>
                            <div class="form-group">
                                <label>邮箱:</label>
                                <input type="email" id="newUserEmail" placeholder="邮箱地址">
                            </div>
                        </div>
                        <button onclick="addUser()" class="btn-primary">添加用户</button>
                    </div>
                    <div id="usersTableDisplay"></div>
                </div>
            </div>

            <!-- 报价管理 -->
            <div id="quotations" class="admin-tab-content">
                <div class="card">
                    <h2>报价管理</h2>
                    <div id="allQuotationsList"></div>
                </div>
            </div>

            <!-- 系统设置 -->
            <div id="system" class="admin-tab-content">
                <div class="card">
                    <h2>系统设置</h2>
                    <div class="system-settings">
                        <div class="form-group">
                            <label>公司名称:</label>
                            <input type="text" id="companyName" placeholder="公司名称">
                        </div>
                        <div class="form-group">
                            <label>公司地址:</label>
                            <input type="text" id="companyAddress" placeholder="公司地址">
                        </div>
                        <div class="form-group">
                            <label>公司电话:</label>
                            <input type="text" id="companyPhone" placeholder="公司电话">
                        </div>
                        <div class="form-group">
                            <label>公司邮箱:</label>
                            <input type="email" id="companyEmail" placeholder="公司邮箱">
                        </div>
                        <div class="form-group">
                            <label>付款条款:</label>
                            <textarea id="paymentTerms" placeholder="付款条款"></textarea>
                        </div>
                        <div class="form-group">
                            <label>收款银行:</label>
                            <input type="text" id="bankName" placeholder="银行名称">
                        </div>
                        <div class="form-group">
                            <label>账户名:</label>
                            <input type="text" id="accountName" placeholder="账户名">
                        </div>
                        <div class="form-group">
                            <label>账号:</label>
                            <input type="text" id="accountNumber" placeholder="账号">
                        </div>
                        <div class="form-group">
                            <label>路由号:</label>
                            <input type="text" id="routingNumber" placeholder="路由号">
                        </div>
                        <div class="form-group">
                            <label>Zelle:</label>
                            <input type="text" id="zelleInfo" placeholder="Zelle信息">
                        </div>
                        <div class="form-group">
                            <label>SWIFT:</label>
                            <input type="text" id="swiftCode" placeholder="SWIFT代码">
                        </div>
                        <button onclick="saveSystemSettings()" class="btn-primary">保存设置</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="script.js"></script>
</body>
</html>

