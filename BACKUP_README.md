# 数据备份功能使用说明

## 概述

本系统提供了完整的数据备份解决方案，包括手动备份、自动备份和数据恢复功能。所有备份数据以JSON格式保存，确保数据的完整性和可读性。

## 功能特性

### 1. 完整数据备份
- **价格数据**：包含所有产品价格信息
- **配置信息**：数据库配置、数据源配置、系统设置
- **元数据**：用户信息、报价单、客户信息、产品信息
- **时间戳**：记录备份创建时间
- **版本信息**：备份文件格式版本

### 2. 自动备份
- **定时备份**：可设置备份间隔（小时）
- **自动执行**：系统自动在指定时间执行备份
- **状态监控**：实时显示备份状态和下次备份时间
- **配置持久化**：备份配置保存在本地存储中

### 3. 数据恢复
- **完整恢复**：从备份文件恢复所有数据
- **安全确认**：恢复前会要求用户确认
- **自动重载**：恢复完成后自动刷新页面

## 使用方法

### 访问备份管理

1. 登录系统（使用管理员账户）
2. 在管理员后台中点击"数据备份"标签
3. 进入备份管理界面

### 创建手动备份

1. 在"手动备份"部分点击"创建完整备份"
2. 系统将自动收集所有数据并生成备份文件
3. 备份文件将自动下载到本地

### 配置自动备份

1. 在"自动备份配置"部分点击"配置自动备份"
2. 输入备份间隔（小时），例如24表示每24小时备份一次
3. 系统将自动设置定时备份任务

### 从备份恢复

1. 在"手动备份"部分点击"从备份恢复"
2. 选择之前创建的备份文件（.json格式）
3. 确认恢复操作
4. 系统将自动恢复所有数据并刷新页面

## 备份文件格式

备份文件为JSON格式，包含以下结构：

```json
{
  "timestamp": "2024-01-01T12:00:00.000Z",
  "version": "1.0",
  "database": {
    "priceTable": [...],
    "categories": [...],
    "systems": [...],
    "statistics": {...}
  },
  "configuration": {
    "dbConfig": {...},
    "dataSourceConfig": {...},
    "systemSettings": {...}
  },
  "metadata": {
    "users": [...],
    "quotations": [...],
    "customers": [...],
    "products": [...]
  }
}
```

## 安全建议

### 1. 备份频率
- **重要数据**：建议每日备份
- **一般数据**：建议每周备份
- **配置变更**：每次重要配置变更后立即备份

### 2. 备份存储
- **本地存储**：将备份文件保存在安全位置
- **云端备份**：考虑将备份文件上传到云存储
- **多重备份**：创建多个备份副本

### 3. 备份验证
- **定期测试**：定期测试备份文件的恢复功能
- **数据完整性**：验证恢复后的数据完整性
- **功能测试**：确保恢复后系统功能正常

## 故障排除

### 常见问题

#### 1. 备份创建失败
- 检查数据库连接状态
- 确认有足够的内存和存储空间
- 查看浏览器控制台错误信息

#### 2. 自动备份不工作
- 检查自动备份配置是否正确
- 确认浏览器标签页保持打开状态
- 验证localStorage是否可用

#### 3. 恢复失败
- 确认备份文件格式正确
- 检查备份文件是否损坏
- 验证系统权限

### 错误代码

- **E001**：数据库未初始化
- **E002**：备份文件格式无效
- **E003**：恢复过程中数据库错误
- **E004**：配置信息损坏

## 技术实现

### 核心技术
- **SQLite数据库**：使用sql.js库实现本地数据库
- **localStorage**：存储配置和元数据
- **File API**：处理文件上传和下载
- **定时器**：实现自动备份功能

### 数据流程
1. **数据收集**：从数据库和localStorage收集所有数据
2. **格式转换**：将数据转换为标准JSON格式
3. **文件生成**：创建包含时间戳和版本信息的备份文件
4. **下载保存**：自动下载备份文件到本地

### 恢复流程
1. **文件验证**：检查备份文件格式和完整性
2. **数据解析**：解析JSON数据并验证结构
3. **数据库恢复**：清空现有数据并插入备份数据
4. **配置恢复**：恢复所有系统配置和设置

## 更新日志

### v1.0 (2024-01-01)
- 初始版本发布
- 支持完整数据备份
- 支持自动备份配置
- 支持数据恢复功能

## 联系支持

如果在使用过程中遇到问题，请：
1. 查看浏览器控制台错误信息
2. 检查备份文件格式是否正确
3. 联系系统管理员获取技术支持

---

**注意**：备份功能是数据安全的重要保障，请定期使用并妥善保管备份文件。
